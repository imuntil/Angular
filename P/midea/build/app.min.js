/* 
 * author:  
 * demo-1.0.0.js 
 * date: 2015-11-13 
 */ 
!function(){function a(a,b){a.setConfig(!0),wx.ready(function(){var a=b();a.sam.then(function(){alert("分享好友成功")}),a.stl.then(function(){alert("分享朋友圈成功")})})}var b=angular.module("myApp",["app.controllers","app.wechatRelated","app.datas"]);b.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/index/0"),a.state("index",{url:"/index/:movieID",views:{"":{templateUrl:"views/index.html"},"KV@index":{template:"<header><p>LOGO<br/>活动KV</p></header>"},"main@index":{template:"<div><md-video></md-video></div>",controller:"IndexController"}}}).state("index.ends",{url:"/ends",views:{"main@index":{templateUrl:"views/ends.html",controller:"EndsController"}}}).state("index.share",{url:"/share",views:{"main@index":{templateUrl:"views/share.html",controller:"ShareController"}}})}]),a.$inject=["wechatConfig","defaultShare"],b.run(a)}(),function(){angular.module("app.controllers",["ui.router","app.datas","ngSanitize","app.wechatRelated","h5video"]).controller("IndexController",["$scope","$state","$sce","$stateParams","movies","ends","shared","$rootScope",function(a,b,c,d,e,f,g,h){var i=d.movieID;a.movieURL=c.trustAsResourceUrl(e[i]),a.controls=!0,a.autoplay=!1,a.videoEnd=function(){0==i?b.go("index.ends"):(f[i-1].watched=!0,g.hasShared?b.go("index.ends"):(g.hasShared=!0,b.go("index.share")))},h.layerShow=!1}]).controller("EndsController",["$scope","$state","$location","ends","$rootScope",function(a,b,c,d,e){a.ends=d,a.watchMovies=function(b){a.ends[b-1].watched||c.path("/index/"+b)},e.layerShow=!1}]).controller("ShareController",["$rootScope","$scope","$state","WechatBrowser","defaultShare",function(a,b,c,d,e){function f(){c.go("index.ends")}a.isWechat=d,a.layerShow=!1,a.hideLayer=function(){a.layerShow=!1},b.wxShare=function(){a.layerShow=!0;var b=e({title:"这是另一个分享"});b.sam.then(f),b.stl.then(f)},b.wbShare=function(){console.log("sina")}}])}(),function(){angular.module("h5video",[]).directive("mdVideo",function(){return{restrict:"AE",template:'<video ng-src="{{movieURL}}" v-controls="{{controls}}" v-play="{{autoplay}}"></video>',replace:!0,scope:!0,link:function(a,b,c){"true"==c.vControls&&b.attr("controls",!0),"true"==c.vPlay&&b.attr("autoPlay",!0);var d=b[0];d.addEventListener("canplay",function(a){d.play()}),d.addEventListener("ended",function(b){a.videoEnd()})}}})}(),function(){angular.module("app.datas",[]).value("movies",["http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2","http://data.video.qiyi.com/videos/other/20150626/f3/7b/92a64fea686d55e9814f776b72fa13c2.mp4?pv=0.2"]).value("ends",[{movie:"结局1",watched:!1},{movie:"结局2",watched:!1},{movie:"结局3",watched:!1},{movie:"结局4",watched:!1},{movie:"结局5",watched:!1},{movie:"结局6",watched:!1}]).value("shared",{hasShared:!1}),angular.module("app.wechatRelated",[]).provider("wechatConfig",function(){var a="http://api.jtuntech.com/event/2015/roewe/jssdk.php?act=config";return{setUrl:function(b){b&&(a=b)},$get:["$http",function(b){function c(){return b({method:"GET",url:a})}function d(a){c().success(function(b){wx.config({debug:a,appId:b.AppId,timestamp:b.Stamp,nonceStr:b.NonceStr,signature:b.Signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]})})}return{setConfig:d}}]}}).provider("wxsCopywriter",{defaultCW:{title:"wechat share title",desc:"wechat share desc",link:"wechat share link",imgUrl:"wechat share img url"},setDefaultCW:function(a){a&&angular.extend(this.defaultCW,a)},$get:function(){var a=this;return a.defaultCW}}).factory("shareTimeline",["wxsCopywriter","$q",function(a,b){var c=a;return function(a){angular.isObject(a)&&angular.extend(c,a);var d=b.defer();return wx.onMenuShareTimeline({title:c.title,link:c.link,imgUrl:c.imgUrl,success:function(){d.resolve()},error:function(){d.reject()}}),d.promise}}]).factory("shareAppMessage",["wxsCopywriter","$q",function(a,b){var c=a;return function(a){angular.isObject(a)&&angular.extend(c,a);var d=b.defer();return wx.onMenuShareAppMessage({title:c.title,desc:c.desc,link:c.link,imgUrl:c.imgUrl,type:"link",dataUrl:"",success:function(){d.resolve()},error:function(){d.reject()}}),d.promise}}]).factory("defaultShare",["shareTimeline","shareAppMessage","$q",function(a,b,c){return function(c){var d=a(c),e=b(c);return{sam:e,stl:d}}}]).factory("WechatBrowser",function(){var a=navigator.userAgent.toLowerCase();return/mobile/.test(a)&&/micromessenger/.test(a)?!0:!1})}();